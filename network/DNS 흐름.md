## DNS(Domain Name System)
인터넷은 2개의 주요 이름 공간을 관리하는데, 하나는 `도메인 네임 계층`, 다른 하나는 `인터넷 프로토콜(IP)` 주소 공간이다.

도메인 네임 시스템(DNS)은 도메인 네임 계층을 관리하며 해당 네임 계층과 주소 공간 간의 상호 확인 및 변환 할 수 있는 시스템이다.

사람은 www.example.com 과 같은 `도메인 이름`을 통해 온라인으로 정보를 엑세스한다.<br>
웹 브라우저는 `IP(인터넷 프로토콜) 주소`를 통해 상호작용한다.

DNS는 브라우저가 인터넷 자원을 로드할 수 있도록 `도메인 이름`을 `IP 주소`로 변환한다.<br>
인터넷 도메인 주소 체계로서 TCP/IP의 응용에서 www.example.com 과 같은 주 컴퓨터의 도메인 네임을 192.168.1.0과 같은 IP 주소로 변환하고 라우팅 정보를 제공하는 분산형 데이터베이스 시스템이다.

`DNS 서버`는 웹 서버 주소에 해당하는 IP 주소 테이블을 가지고 있는 서버라고 보면 된다.<br>
DNS 서버를 사용하면 사람이 192.169.1.0과 같은 IP 주소 또는 영문과 숫자로 된 복잡한 IP 주소를 기억할 필요가 없다.

## DNS 과정
1. DNS Query<br>
  DNS 서버에서 도메인 이름을 이용하여 IP를 받아온다.<br>
  이때 도메인 네임 서버에 접속하는 유저에 대해 `Round Robin 방식`으로 IP를 할당한다.<br>
2. IP Communication<br>
  IP를 받아온 유저는 리퀘스트 메시지 발송을 통하여 정상적으로 네트워크 통신을 실시한다.<br>

## DNS round robin 방식
Round Robin이란 DNS 서버 구성 방식 중 하나이다.<br>
Domain에 대한 IP 요청 쿼리 시 Round Robin 방식으로 IP를 반환한다.

시분할 시스템을 위해 설계된 선점형 스케줄링의 하나로서, 프로세스들 사이에 우선순위를 두지 않고,<br>
순서대로 `시간단위(Time Quantum/Slice)`로 CPU를 할당하는 방식의 **CPU 스케줄링 알고리즘**이다.

쉽게 말하면 자바에서 스레드가 운영체제의 스케쥴러에 의하여 컴퓨터 자원을 사용할 수 있는 기회를 할당받는 것과 같은 맥락이다.
각 프로세스에 일정시간을 할당하고, 할당된 시간이 지나면 그 프로세스는 잠시 보류한 뒤 다른 프로세스에게 기회를 주고,
또 그 다음 프로세스에게 하는 식으로, 돌아가며 기회를 부여하는 운영방식이라 풀어 말할 수 있다.

즉 DNS 서버에 대한 Round Robin 형식으로 구성할 경우 자동으로 시간에 따라서 스케줄링이 변환되기 때문에<br>
로드 벨런서가 필요 없고 부하가 없다.

## DNS Round Robin 방식의 문제점
1. 서버의 수 만큼 공인 IP 주소가 필요하다.<br>
  부하 분산을 위해 서버의 대수를 늘리기 위해서는 가 만큼의 공인 IP가 필요하다.<br>
2. 균등하게 분산되지 않는다.<br>
  모바일 사이트 등에서 문제가 될 수 있는데, 스마트폰의 접속은 캐리어 게이트웨이라고 하는 `프록시 서버`를 경유한다.
  프록시 서버에서는 이름 변환 경과가 일정 시간 동안 캐싱되므로 같은 프록시 서버를 경유하는 접속은 항상 같은 서버로 접속된다.
  또한 PC 용 웹 브라우저도 DNS 질의 결과를 캐싱하기 때문에 균등하게 부하분산 되지 않는다.
  DNS 레코드의 TTL 값을 짧게 설정함으로써 어느정도 해소가 되지만, 
  TTL에 따라 캐시를 해제하는 것은 아니므로 반드시 주의가 필요하다.
3. 서버가 다운되도 확인이 불가능하다.<br>
  DNS 서버는 웹 서버의 부하나 접속 수 등의 상황에 따라 질의결과를 제어할 수 없다.<br>
  웹 서버의 부하가 높아서 응답이 느려지거나 접속 수가 꽉 차서 접속을 처리할 수 있는 상황인지를 전혀 감지할 수가 없기 때문에
  어떤 원인으로 다운되더라도 이를 검출하지 못하고 유저들에게 제공된다. 
  이 때문에 유저들은 간혹 다운된 서버로 연결이 되기도 한다.<br>
  DNS 라운드 로빈은 어디까지나 부하 분산을 위한 방법이지 다중화 방법은 아니므로 다른 S/W와 조합해서 관리할 필요가 있다.

## 극복 방법
* 다중화 구성 방식(Synchronous Time-Division Multiplexing)
* 가중치 편성 방식(Weighted round robin)
* 최소 연결 방식(Least connection)

## 다중화 구성 방식(Synchronous Time-Division Multiplexing)
AP 서버에 VIP(Virtual IP)를 부여해서 다중화를 구성한다. 각 AP 서버를 Health Check 후 이상이 감지되면 <br>
VIP를 정상 AP 서버로 인계하는 방식을 사용한다.<br>
즉 DNS Server Table에 실시간으로 AP 서버의 상태를 확인할 수 있는 칼럼 및 함수를 추가하여 요청될 경우<br>
서버 상태를 확인하여 우회루트를 제공하거나 에러를 전송하는 방식을 말한다.<br>

## Weighted round robin (WRR) 가중치 편성 방식
각각의 웹 서버에 가중치를 가미해서 분산 비율을 변경한다. 물론 가중치가 큰 서버일수록 빈번하게 선택되므로<br>
처리능력이 높은 서버는 가중치를 높게 설정하는 것이 좋다.

## Least connection
> 로드 밸런서 도입

접속 클라이언트 수가 가장 적은 서버를 선택한다. 로드 밸런서에서 실시간으로 connection 수를 관리하거나<br>
각 서버에서 주기적으로 알려주는 것이 필요하다.

## References
* http://dailusia.blog.fc2.com/blog-entry-362.html

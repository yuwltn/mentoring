프로세스는 프로그램에 사용되는 데이터와 메모리 등의 `자원` 그리고 `스레드`로 구성된다.

## 스레드(Thread)란?

> 프로세스는 운영체제로부터 `자원을 할당`받는 작업의 단위이고 <br>
> 스레드는 프로세스가 할당받은 `자원을 이용`하는 실행의 단위이다.


스레드(thread)란 프로세스(process) 내에서 실제로 작업을 수행하는 주체를 의미한다.<br>
모든 프로세스에는 `한 개 이상`의 스레드가 존재하여 작업을 수행한다.<br>
`두 개 이상`의 스레드를 가지는 프로세스를 `멀티스레드 프로세스(multi-threaded process)`라고 한다.<br>

싱글 스레드 프로세스 | 멀티 스레드 프로세스<br>
<img src="https://github.com/yuwltn/yuwltn/blob/main/thread.PNG" width = "500" height = "300" >

하나의 프로세스를 구성하는 스레드들은 프로세스에 할당된 메모리, 자원 등을 `공유`한다.<br>
각각의 스레드는 `독립적인 작업`을 수행해야 하기 때문에 각자의 `스택`과 `PC 레지스터 값`을 갖고 있다.

## 스택을 스레드마다 독립적으로 할당하는 이유
스택은 함수 호출 시 전달되는 인자, 되돌아갈 주소값 및 함수 내에서 선언하는 변수 등을<br> 
저장하기 위해 사용되는 `메모리 공간`이므로 <br>
스택 메모리 공간이 독립적이라는 것은 `독립적인 함수 호출`이 가능하다는 것이고<br>
이는 `독립적인 실행 흐름` 을 가능하게 한다.<br><br>
따라서 독립적인 실행 흐름을 위한 `최소 조건`으로 `독립된 스택을 할당`한다.

## PC Resister를 스레드마다 독립적으로 할당하는 이유
`PC 값`은 스레드가 명령어의 어디까지 수행하였는지를 나타낸다.<br>
스레드는 CPU를 할당받았다가 `스케줄러`에 의해 다시 선점당한다.<br>
그렇기 때문에 명령어가 연속적으로 수행되지 못하고어느 부분까지 수행했는지 `기억`할 필요가 있다.<br><br>
따라서 PC 레지스터를 `독립적`으로 할당한다.<br>

## 멀티 스레드

하나의 스레드보다는 여러 스레드로 작업하는게 더 좋지 않을까? 생각했는데<br>
현실은 그렇게 간단하지 않다.<br>
모든 기술들에는 각각의 기회비용이 존재하고, 싱글 스레드와 멀티 스레드 역시 각각의 장점에 맞는 기회비용들이 존재한다.<br><br>
멀티 스레드는 하나의 프로세스 내에서 둘 이상의 스레드가 `동시에` 작업을 수행하는 것을 의미하는데<br>
이러한 작업은 `컨텍스트 스위칭(Context Switching)`을 통해서 이루어진다.<br><br>
하나의 스레드에서 다음 스레드로 이동을 하면서, 컨텍스트 스위칭이 일어나고<br>
스위칭이 일어나면서 부분적으로 조금씩 각각의 스레드에 대한 작업을 끝내게 된다.<br>
즉, 컨텍스트 스위칭이 엄청 빠르게 일어나면서, 사용자의 시선에서는 프로그램들이 `동시에` 수행되는 것처럼 보인다.<br><br>
멀티 스레드에서 스레드 간 스택 영역만 비공유하고 데이터 영역과 힙 영역은 공유한다.<br>

## 멀티 스레드 장점
1. **응답성** : 프로그램의 일부분(스레드 중 하나)이 중단되거나 긴 작업을 수행하더라도 프로그램의 `수행이 계속` 되어 사용자에 대한 응답성이 증가한다. 즉, 멀티 스레드 모델은 에러 발생 시 `새로운 스레드를 생성`하여 극복한다. 다만, 새로운 스레드 생성이나 놀고 있는 스레드 처리에 `비용이 발생`한다. ( 싱글 스레드는 프로그램 일부분이 중단되거나, 에러가 발생하면 프로그램이 멈춘다 )
2. **경제성** : 프로세스 내 자원들과 `메모리를 공유`하기 때문에 메모리 공간과 시스템 `자원 소모가 줄어든다.` 스레드 간 통신이 필요한 경우에도 쉽게 데이터를 주고 받을 수 있으며, 프로세스의 context switching과 달리 스레드 간의 context switching은 캐시 메모리를 비울 필요가 없기 때문에 더 `빠르다.`
3. **멀티프로세서의 활용** : 다중 CPU 구조에서는 각각의 스레드가 다른 프로세서에서 병렬로 수행될 수 있으므로 `병렬성`이 증가한다.

## 멀티 스레드 문제점

1. 컨텍스트 스위칭, 동기화 등의 이유 때문에 싱글 코어 멀티 스레딩은 스레드 생성 시간이 오히려 오버헤드로 작용해 싱글 스레드보다 `느리다.`
2. 공유하는 자원에 동시에 접근하는 경우, 프로세스와는 달리 스레드는 데이터와 힙 영역을 공유하기 때문에 어떤 스레드가 다른 스레드에서 사용 중인 변수나 자료구조에 접근하여 엉뚱한 값을 읽어오거나 수정할 수 있다. 따라서 `동기화`가 필요하다.
3. 멀티 스레딩을 위해서는 `운영체제의 지원`이 필요하다.
4. 멀티 스레드 모델은 프로그래밍 `난이도가 높다`. 또한, 스레드 수만큼 `자원을 많이 사용`한다. 초보자의 경우, 동일한 프로그램을 만든다면, 싱글 스레드로는 완성이라도 한다. 그러나, 멀티 스레드의 경우는 완성도 못하는 경우도 많다.
5. `문맥 교환`에 걸리는 시간이 커지면 커질수록, 멀티 스레딩의 효율은 저하된다.  컴퓨터에서 동시에 처리할 수 있는 최대 작업 수는 CPU의 코어(core) 수와 같다. 만약 CPU의 코어 수보다 더 많은 스레드가 실행되면, 각 코어가 정해진 시간 동안 여러 작업을 번갈아가며 수행하게 된다. 이때 각 스레드가 서로 교체될 때 스레드 간의 문맥 교환(context switching)이라는 것이 발생한다. 문맥 교환이란 현재까지의 작업 상태나 다음 작업에 필요한 각종 데이터를 저장하고 읽어오는 작업을 가리킨다.

많은 양의 단순한 계산은 싱글 스레드로 동작하는 것이 더 효율적일 수 있다.<br>
따라서 많은 수의 스레드를 실행하는 것이 언제나 좋은 성능을 보이는 것은 아니라는 점을 유의해야 한다.

## 멀티 스레드 vs 멀티 프로세스
멀티 스레드는 `하나의 프로세스` 내에서 `둘 이상의 스레드`가 동시에 작업을 수행하는 것을 의미하고<br>
멀티 프로세스는 `여러 개의 CPU`를 사용하여 `여러 프로세스`를 동시에 수행하는 것을 의미한다.

* 공통점<br>
멀티 스레드와 멀티 프로세스 모두 `여러 흐름을 동시에 수행`한다.<br>
* 차이점<br>
멀티 프로세스는 각 프로세스가 독립적인 메모리를 가지고 `별도`로 실행되지만, <br>
멀티 스레드는 각 스레드가 자신이 속한 프로세스의 메모리를 `공유`한다.<br><br>

멀티 스레드는 멀티 프로세스보다 적은 메모리 공간을 차지하고 컨텍스트 스위칭이 빠른 장점이 있지만,<br> 
동기화 문제와 하나의 스레드 장애로 전체 스레드가 종료 될 위험을 갖고 있다.<br><br>

멀티 프로세스는 하나의 프로세스가 죽더라도 다른 프로세스에 영향을 주지 않아 안정성이 높지만,<br> 
멀티 스레드보다 많은 메모리공간과 CPU 시간을 차지하는 단점이 있다.<br><br>

각각의 장단점이 있으므로 적용하는 시스템에 따라 적합한 동작 방식을 선택하여 적용해야 한다.

### 왜 멀티 프로세스로 할 수 있는 작업들을 굳이 하나의 프로세스에서 스레드로 나눠가며 할까?
> 효율적인 자원 관리, 처리 비용 감소

운영체제가 시스템 자원을 효율적으로 관리하기 위해 스레드를 사용하는데<br>
멀티 프로세스로 실행되는 작업을 멀티 스레드로 실행할 경우, <br>
프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다.<br>
프로세스 간의 통신보다 스레드 간의 통신 비용이 적으므로 작업들 간 통신의 부담이 줄어든다. (프로세스는 독립구조이기 때문)<br>

### 그렇다면 무조건 멀티 스레드가 좋을까?
스레드를 활용하면 자원의 효율성이 증가하기도 하지만, <br>
스레드 간의 자원 공유는 `전역 변수`를 이용하므로 `동기화 문제`가 발생 할 수 있으므로 주의가 필요하다.<br>
